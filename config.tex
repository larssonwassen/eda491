\section{Firewall Configuration}
\label{sec:config}

The final firewall configuration is shown in listening \ref{list:final_firewall_config} and displays all the firewall's rules. This inital firewall configuration in section \ref{sec:setup} is a subset of the final firewall configuration due to that the intial configuration has rules that are needed to operate the computer. To configure the firewall, the script in Appendix~\ref{app:fw-final} was issued. This script flushed all the old rules and set up a new configuration acording to our rules. 

One of the first things to decide upon is which fundamental rule to apply regarding security in firewalls. The choice is either to drop all traffic that is not permitted by the rules or to accept all traffic that is not denied by the rules. Our choice was to drop the traffic that was not specifically permitted due to it makes the system more secure. The latter choice opens up for security risks if the system is not properly configured in a heigher manner than the first choice does. If the choice was to drop all the unspecified traffic the risk is heigher that the firewall drops valid data than to accept malicious data, but if the firewall accept all traffic that is not blocked by rules it is more likely that it actually accepts malicious data.

The defined rules maked certain unwanted traffic were droped and valid traffic accepted. First, all the traffic where checked for malicious or malformed content and droped if they matched any of those rules. The denying rules covered IP spoofing, ping flooding and Xmas scan. Second followed a number of rules that checked whether the content seemd valid and if a packed matched any of these rules, it was accepted and forwarded. The allowing rules let through limited ping requests, established TCP connections, traffic sent in loopback mode, outgoing traffic and new connections to specified services. Lastly was the traffic that had not been matched by either the denying or the allowing rules logged before the default action - drop - was issued. The rules with their purpose and the mentioned organization can easily be seen in the script in Appendix~\ref{app:fw-final}.

The first problem was concerning IP spoofing. It is not possible to ensure that an IP is not spoofed, so there is no way to completely overcome this problem. What usally is done - and what we also did - was to drop all incoming packages with a source IP address that did not belong to the current network, which correspond to the rules on lines 4-7. Further was rules from line 31 to 46 added to drop all the outgoing traffic that either had a source or a destination IP address that did not belong to the current network. 

The second problem was malformed TCP packages. 

\inlinetodo{Describe the new firewall configuration, together with the output, e.g., 
rule on line 5 ensures that the number of ping packets are limited to 1. Don't 
forget to refer to your script in Appendix~\ref{app:fw-final}.}

\lstinputlisting[caption=Final firewall 
configuration,label=lst:fw-config]{firewall-final.txt}\label{list:final_firewall_config}



