\section{Firewall Correctness}
\label{sec:correctness}

The verification process is important and if the firewalls correctness can't be assured, the system behind the firewall can be endangered. The verification process for the final firewall configuration was performed in two steps. The first step was human inspection, we looked through the rules and their order and assured us of the correctness. The second step was performed by launching various "attacks" towards the system hosting the firewall, from a computer on the same local network. The attacks carried out were among others different kinds of TCP port scans and ICMP pings.

Step one, as mentioned above, was human inspection. Here we examined the correctness of each rule, the ordering of the rules and whether the firewall could be considered as stateful. The correctness of each rule was performed but will not be covered in this report.  

As explained in section~\ref{sec:config} we took care in which order the rules were placed. The followed concept of first having a number of rules, the denying rules, that filtered away unwanted packages that would otherwise - possibly - be accepted by the following number of rules, the allowing rules, that accepts wanted packages. As also explained in section~\ref{sec:config}, if a package neither is matched with the two rule sets the package will face the default policy, which was set to DROP the package. The denying rules span from line 4 to 11 on the INPUT chain and from line 31 to 46 on the OUTPUT chain, see Listening \ref{list:final_firewall_config}. Internally in each chain it does not matter in which order they are placed, but there is one exception. The lines 10 and 11 has to be placed last of the denying rules in the INPUT chain due to that those two lines regarding the ICMP ping filtering are composed by a dropping and an accepting rule. Because it holds a accepting rule they has to be placed last so that all unwanted traffic first are filtered away before it may reach the ICMP filtering rules. The applying rules are on line 12 to 19 in chain INPUT and on line 18 and 19 on chain OUTPUT, see Listening \ref{list:final_firewall_config}. The ordering of the applying rules do not matter and could be written in any order. By using the explained concept and the ordering explained inside each two rule sets we believe that the ordering of the rules are correct.

The firewall can be considered as stateful as we have rules that depends on the state of a connection. More specifically the rule on line 12 accepts traffic based on if they are in the state established or related. Established means that packages have been exchanged with this host previously on the specific port in both directions and related means that a new connection should be accepted if there exist another established connection on some other port from the same host.

The second step was to perform penetrate testing. This was carried out by using SSH to an remote host in the same local network and from there send different sort of "attacks" against our host with the configured firewall. One of the "attacks" that we tried was sending a batch of pings with: \texttt{ping -i 0.2 <hostname>}. This command sends a new ping every 0.2\.s and monitored the responses. As we first got five responses and then just one response per second we deemed this part of the firewall working. We also tested to se if all ports that should be opened (22, 8080, 111) were open and all other ports closed. This was done using the command \texttt{sudo nmap 129.16.23.134} on the remote host. This command does a TCP port scan and outputs the state of all ports on the target. In our case it showed that port 22, 8080, and 111 was open and all other got the status filtered. The fact that they were filtered meant that the firewall dropped the packets. We know that they got dropped before they reached the underlying system as the rules doing the filtering is in the INPUT chain.